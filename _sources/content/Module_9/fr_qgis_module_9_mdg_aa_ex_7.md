::::{grid} auto
:::{grid-item-card}
:class-card: sd-text-center sd-rounded-circle
:link: https://giscience.github.io/gis-training-resource-center/content/intro.html 
{octicon}`home-fill;1.5em;sd-text-danger`
:::
::::

# Exercice 7 : AccessibilitÃ© des postes de santÃ© depuis les entrepÃ´ts CRM

## CaractÃ©ristiques


::::{grid} 2
:::{grid-item-card}
__Type d'exercice:__
^^^

- Cet exercice peut Ãªtre utilisÃ© dans le cadre de formations en ligne ou en prÃ©sentiel.
- Il peut Ãªtre rÃ©alisÃ© en tant qu'exercice guidÃ© ou individuellement en auto-apprentissage.

:::

:::{grid-item-card}
__Piste d'Exercice:__
^^^

Cet exercice est le cinquiÃ¨me exercice de la piste d'exercice ["Analyse dâ€™Action Anticipative pour les Cyclones Ã  Madagascar"](/content/Exercise_tracks/fr_mdg_aa_cyclones.md)

:::

::::

::::{grid} 2
:::{grid-item-card}
__Temps estimÃ© pour l'exercice__
^^^

1 Ã  2 heures

:::

:::{grid-item-card}
__Articles Wiki pertinents__
^^^

* [Zonal Statistics](https://giscience.github.io/gis-training-resource-center/content/Wiki/en_qgis_raster_basic_wiki.html)
* [Intersection](https://giscience.github.io/gis-training-resource-center/content/Wiki/en_qgis_spatial_joins_wiki.html#join-attributes-by-location-summary)
* [Projections](/content/Wiki/en_qgis_projections_wiki.md)
* [Buffer](/content/Wiki/en_qgis_projections_wiki.md)
* [Clip](/content/Wiki/en_qgis_projections_wiki.md)
* [Automatisation](https://giscience.github.io/gis-training-resource-center/content/Wiki/en_qgis_automatisation_wiki.html)

:::

::::

:::{card}
:class-card: sd-border-1 sd-shadow-none
__Objectif de l'exercice:__
^^^
Aina, l'experte GIS (SIG) de la Croix-Rouge malgache (CRM), se prÃ©pare pour la prochaine saison des cyclones. Elle souhaite emÃ©liorer la capacitÃ© de rÃ©action de son Ã©quipe une fois une tempÃªte annoncÃ©e, en automatisant des analyses clÃ©s dans la application QGIS. 
Celles-ci incluent l'estimation des populations exposÃ©es, l'identification des services impactÃ©s comme la santÃ© et l'education, et l'Ã©valuation de l'accessibilitÃ© des postes de santÃ© Ã  partir des entrepÃ´ts de la croix rouge dans une fenÃªtre critique de 10 heures. 
L'objectif est de prÃ©parer un workflow d'analyse et de visualisation pour soutenir une action anticipÃ©e (eng.: Anticipatory Action) et fondÃ©e sur les donnÃ©es, avant que le cyclone ne touche terre. 


:::

## Instruction pour les formateurs


:::{dropdown} __Espace Formateurs (Trainers Corner)__ 

### PrÃ©parer la formation

- Prenez du temps pour vous familiariser avec l'exercice et le matÃ©riel founi. 
- PrÃ©parez un tableau blanc. Cela peut Ãªtre un tableau physique, un paperboard (tableau blanc virtuel, e.g., Miro Board) oÃ¹ les participantÂ·es peuvent ajouter leurs observations et questions. 
- Avant de commencer l'exercice, assurez-vous que tout le monde a installÃ© QGIS et a tÃ©lÃ©chargÃ© __et dÃ©zippÃ©__ le dossier de donnÃ©es.
- Consultez [How to do trainings?](https://giscience.github.io/gis-training-resource-center/content/Trainers_corner/en_how_to_training.html#how-to-do-trainings) pour des conseils gÃ©nÃ©raux sur la conduite de formations (ce matÃ©riel est en anglais).


### Animer la formation

__Introduction:__

- PrÃ©sentez l'idÃ©e et l'objectif de l'exercice.
- Fournissez le lien de tÃ©lÃ©chargement et assurez-vous que tout le monde a bien dÃ©zippÃ© le dossier avant de commencer les tÃ¢ches.

__Exercice guidÃ©e:__

- Montrez et expliquez chaque Ã©tape cous-mÃªme au moins deux fois, et suffisamment lentement por que chacunÂ·e puisse voir ce que vous faites et reproduire les Ã©tapes dans sons prope projet QGIS.
- Assurez-vous que tout le monde suit en demandant rÃ©guliÃ¨rement si quelqu'un a besoid d'aide ou si tout le monde suit toujours.
- Soyez ouvertÂ·e et patientÂ·e face aux questions ou problÃ¨mes Ã©ventuels. Vos participantÂ·es sont en train de faire plusieures choses Ã  la fois: Ã©couter vos instructions tout en s'orientant dans leur propre projet QGIS.

### Fin de la formation

- PrÃ©voyez du temps Ã  la fin pour rÃ©pondre aux questions ou aborder les Ã©ventuels problÃ¨mes rencontrÃ©s lors de tÃ¢ches.
- Laissez un moment pour des questions ouvertes.

:::

---

## TÃ¢ches

Lorsque quâ€™un cyclone est prÃ©vu pour un atterrissage, Aina collabore avec les Ã©quipes logistique et santÃ© pour 
dÃ©cider **oÃ¹ envoyer les kits mÃ©dicaux prÃ©positionnÃ©s**. Cependant, tous les entrepÃ´ts CRM ne stockent pas les 
articles nÃ©cessaires â€” seulement trois le font.

Pour prendre des dÃ©cisions rapides et basÃ©es sur les donnÃ©es, Aina souhaite savoir **quels postes de santÃ© sont accessibles** Ã  partir de ces entrepÃ´ts **en moins de 10 heures**. Cette analyse permet de sâ€™assurer que les kits 
sont envoyÃ©s vers des Ã©tablissements **rÃ©ellement accessibles Ã  temps**.

Son objectif est de crÃ©er une carte visuelle claire montrant les postes de santÃ© accessibles vs. non accessibles â€” 
et de la partager avec les dÃ©cideurs le plus rapidement possible.


### 1. Filtrer les postes de santÃ© depuis le jeu de donnÃ©es national des Ã©tablissements de santÃ©

Avant de vÃ©rifier quels Ã©tablissements sont accessibles, Aina doit isoler les **postes de santÃ©** Ã  partir du jeu de donnÃ©es plus large de tous les Ã©tablissements de santÃ©.

1. **Charger le jeu de donnÃ©es des Ã©tablissements de santÃ©**  
   - Fichier : `hotosm_mdg_health_facilities_points.gpkg` (ou le GeoPackage utilisÃ©)  
   - Chargez-le par glisser-dÃ©poser ou via `Couche` â†’ `Ajouter une couche vecteur`.

2. **Ouvrir la table attributaire** et vÃ©rifier la colonne nommÃ©e `amenity`.

3. **Filtrer par expression** pour ne garder que les postes de santÃ© :  
   - Clic droit sur la couche â†’ `Filtrerâ€¦`  
   - Utiliser lâ€™expression suivante :
     ```qgis
     "amenity" = 'health_post'
     ```

4. **Exporter la couche filtrÃ©e**  
   - Clic droit sur la couche filtrÃ©e dans le panneau des couches â†’ `Exporter` â†’ `Enregistrer les entitÃ©s sousâ€¦`  
   - Format : `GeoPackage`  
   - Enregistrez dans votre dossier `project` sous :
     ```
     health_posts_only.gpkg
     ```
   - Cliquez sur `OK` pour confirmer lâ€™exportation.

5. **Retirer le filtre** ou la couche originale de votre projet pour Ã©viter toute confusion.

> ğŸ’¡ **Astuce**: Filtrer directement dans QGIS vous permet de travailler avec un sous-ensemble spÃ©cifique sans modifier le jeu de donnÃ©es original.


### 2. Charger les couches isochrones pour les trois entrepÃ´ts CRM

Aina sait que seulement **trois entrepÃ´ts** disposent des fournitures mÃ©dicales nÃ©cessaires:  
**Antananarivo**, **Maroantsetra**, et **Tolanaro**. Elle va maintenant charger les couches isochrones pour chacun de ces entrepÃ´ts afin de commencer lâ€™analyse des zones desservies.

1. **Charger les couches isochrones individuelles** pour chaque entrepÃ´t:
   - `CRM_warehouse_Isochrones_Antananarivo.gpkg`
   - `CRM_warehouse_Isochrones_Maroantsetra.gpkg`
   - `CRM_warehouse_Isochrones_Tolanaro.gpkg`

   Vous pouvez glisser-deposer chaque fichier dans QGIS ou aller dans `Couche` â†’ `Ajouter une couche` â†’ `Ajouter une couche vecteur`.


2. **Inspecter la table attributaire** de chaque couche isochrone  
   VÃ©rifiez que chaque enregistrement possÃ¨de un champ `traveltime_h` indiquant le temps de trajet estimÃ© en **heures**.

3. **Retirer toutes les entitÃ©s oÃ¹ le temps de trajet dÃ©passe 10 heures**:  
   - Clic droit sur chaque couche â†’ `Filtrerâ€¦`  
   - Appliquer lâ€™expression:
     ```qgis
     "traveltime_h" <= 10
     ```

4. **Exporter chaque couche filtrÃ©e** vers le dossier `temp`:  
   Ã€ ce stade, Aina sâ€™assure Ã©galement que toutes les couches exportÃ©es utilisent le mÃªme SCR que la couche des postes de santÃ© â€” `EPSG:4326` â€” pour Ã©viter tout problÃ¨me lors de la jointure spatiale.  
   - Enregistrez chaque fichier sous:
     ```
     CRM_isochrones_Antananarivo_upto10h.gpkg
     CRM_isochrones_Maroantsetra_upto10h.gpkg
     CRM_isochrones_Tolanaro_upto10h.gpkg
     ```

5. **Appliquer un style aux isochrones pour plus de clartÃ©**  
   Aina peut appliquer un style prÃ©dÃ©fini pour colorer la couche selon `traveltime_h` et visualiser diffÃ©rentes plages horaires (4h, 6h, 8h, 10h) Ã  lâ€™Ã©tape 5.
   - Clic droit sur chaque couche filtrÃ©e â†’ `PropriÃ©tÃ©s` â†’ `Symbologie`
   - Cliquez sur `Style` en bas â†’ `Charger le styleâ€¦`
   - SÃ©lectionnez le fichier:  
     `CRM_warehouse_isochrones_style.qml`
   - Cliquez sur `Ouvrir`, puis `Appliquer` et `OK`

### 3. Visualiser lâ€™accessibilitÃ© des postes de santÃ© depuis les entrepÃ´ts CRM

Aina doit identifier quels postes de santÃ© sont accessibles par la route Ã  partir des trois entrepÃ´ts clÃ©s (Antananarivo, Maroantsetra et Tolanaro) **en moins de 10 heures de trajet**. Elle va le faire manuellement en combinant les isochrones 10h de ces entrepÃ´ts et en les comparant au jeu de donnÃ©es national des postes de santÃ©.

1. **Fusionner les couches isochrones des trois entrepÃ´ts**  
   - Dans la **BoÃ®te Ã  outils de traitement**, rechercher `Fusionner des couches vecteur`.  
   - **Couches en entrÃ©e**:  
     - `CRM_isochrones_Antananarivo_upto10h.gpkg`  
     - `CRM_isochrones_Maroantsetra_upto10h.gpkg`  
     - `CRM_isochrones_Tolanaro_upto10h.gpkg`  
   - **SCR**: `EPSG:4326`  
   - **Enregistrer sous**:
     ```
     merged_isochrones_10h.gpkg
     ```
   - Cliquez sur **ExÃ©cuter**.

2. **SÃ©lectionner les postes de santÃ© accessibles en moins de 10 heures**  
   - Dans la **BoÃ®te Ã  outils de traitement**, rechercher `SÃ©lection par localisation`.  
   - DÃ©finir les paramÃ¨tres suivants:  
     - **Couche source**: `health_posts_only.gpkg`  
     - **PrÃ©dicat**: `intersects`  
     - **Couche dâ€™intersection**: `merged_isochrones_10h.gpkg`  
   - Cliquez sur **ExÃ©cuter**.
   > ğŸ’¡ Les points sÃ©lectionnÃ©s sont ceux situÃ©s dans les zones de desserte des entrepÃ´ts Ã  moins de 10 heures.

3. **CrÃ©er un champ dâ€™accessibilitÃ© pour les postes sÃ©lectionnÃ©s**  
   - Ouvrir la **calculatrice de champs** ![](/fig/mActionCalculateField.png) sur la couche `health_posts_only`.  
   - Cochez âœ… `Mettre Ã  jour uniquement les entitÃ©s sÃ©lectionnÃ©es`  
   - **Nom du champ de sortie**: `Reachability_time`  
   - **Type du champ de sortie**: `Texte (chaÃ®ne)`  
   - **Expression**:
     ```qgis
     'reachable in 10 hours'
     ```  
   - Cliquez sur **OK** pour crÃ©er et renseigner le champ pour les entitÃ©s sÃ©lectionnÃ©es.

4. **Marquer les autres postes de santÃ© comme non accessibles**  
   - Inverser la sÃ©lection:  
     Allez dans `Ã‰dition` â†’ `Inverser la sÃ©lection` ![](/fig/mActionInvertSelection.png)  
     ou clic droit sur la couche â†’ `Inverser la sÃ©lection`.
   - Ouvrez Ã  nouveau la **calculatrice de champs**.  
   - Cochez âœ… `Mettre Ã  jour uniquement les entitÃ©s sÃ©lectionnÃ©es`  
   - Utiliser le mÃªme champ: `Reachability_time`  
   - **Expression**:
     ```qgis
     'not reachable in 10 hours'
     ```  
   - Cliquez sur **OK** pour appliquer la mise Ã  jour.


> âœ… Tous les postes de santÃ© sont maintenant Ã©tiquetÃ©s comme **accessibles** ou **non accessibles** dans la colonne `Reachability_time`.
