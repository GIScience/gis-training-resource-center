name: deploy-book

on:
  push:
    branches:
      - main

jobs:
  deploy-book:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # Set up Python environment
    - name: Set up Python 3.13
      uses: actions/setup-python@v2
      with:
        python-version: 3.13

    # Install dependencies
    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    # Build English Book
    - name: Build English Book
      run: |
        jupyter-book build . --config _config.yml --toc _toc.yml --path-output english
        echo "English book built successfully."

    # Build Spanish Book
    - name: Build Spanish Book
      run: |
        jupyter-book build . --config _config.yml --toc es_toc.yml --path-output spanish
        echo "Spanish book built successfully."

    # Combine both builds into a single deployable folder
    - name: Combine English and Spanish builds
      run: |
        mkdir -p _site/content _site/spanish
        cp -r english/_build/html/* _site/content/
        cp -r spanish/_build/html/* _site/spanish/
        echo "Created _site with English in /content and Spanish in /spanish"
        ls -R _site

    # Deploy combined site to GitHub Pages
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3.6.1
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_site
        publish_branch: gh-pages
